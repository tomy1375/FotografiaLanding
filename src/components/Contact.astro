---
import { Icon } from 'astro-icon/components';
---

<section id="contact" class="relative">
  <!-- Sección superior con video de fondo -->
  <div class="relative h-[500px] overflow-hidden">
    <!-- Video de fondo -->
    <div class="absolute inset-0 overflow-hidden">
      <video 
        autoplay 
        loop 
        muted 
        playsinline
        class="w-full h-full object-cover grayscale"
      >
        <source src="/boda3.mp4" type="video/mp4" />
        <!-- Imagen de respaldo en caso de que el video no se cargue -->
        <img 
          src="/foto1.webp" 
          alt="Fotografía de boda" 
          class="w-full h-full object-cover grayscale"
        />
      </video>
      <div class="absolute inset-0 bg-black opacity-50"></div>
    </div>
    
    <!-- Contenido superpuesto -->
    <div class="container mx-auto px-6 h-full flex flex-col items-center justify-center relative z-10">
      <div class="max-w-3xl mx-auto text-center text-white">
       <h2 class="text-4xl md:text-5xl lg:text-6xl font-light mb-6 tracking-wide">
  CUÉNTANOS<br />TU<br />HISTORIA
</h2>

        <p class="text-lg font-light max-w-2xl mx-auto leading-relaxed">
          Nuestro equipo está disponible para bodas en toda Europa. Te responderemos en menos de 48 horas. Si no, contáctanos por WhatsApp: 
          <a href="tel:+61412345678" class="underline hover:text-yellow-200 transition-colors">+61 412 345 678</a>. 
          Si eres un organizador de eventos, envíanos un correo a 
          <a href="mailto:info@cassandraladru.com" class="underline hover:text-yellow-200 transition-colors">info@elodiemoreaux.com</a>.
        </p>
      </div>
    </div>
    
    <!-- Forma diagonal para la transición -->
    <div class="absolute bottom-0 left-0 right-0 h-24 bg-white" style="clip-path: polygon(0 101%, 100% 100%, 100% 0);"></div>
  </div>
  
  <!-- Sección del formulario -->
  <div class="bg-white py-20">
    <div class="container mx-auto px-6 max-w-screen-xl">
      <form 
        class="max-w-4xl mx-auto space-y-8"
        id="contact-form"
      >
        <!-- Campos ocultos para Web3Forms -->
        <input type="hidden" name="access_key" value="7ed836a7-266b-4f1c-b507-697bab218b47" />
        <input type="hidden" name="subject" value="Nuevo mensaje de contacto - Cassandra Ladru Photography" />
        <input type="hidden" name="from_name" value="Cassandra Ladru Photography" />
        <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />
        
        <!-- Nombre (dividido en dos campos) -->
        <div>
          <label class="block text-sm font-light text-gray-700 mb-1">Nombre <span class="text-xs text-gray-500">(requerido)</span></label>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <input 
                type="text" 
                name="nombre" 
                placeholder="Nombre" 
                class="w-full px-0 py-2 border-0 border-b border-gray-300 focus:outline-none focus:border-gray-900 bg-transparent"
                required
              />
            </div>
            <div>
              <input 
                type="text" 
                name="apellido" 
                placeholder="Apellido" 
                class="w-full px-0 py-2 border-0 border-b border-gray-300 focus:outline-none focus:border-gray-900 bg-transparent"
                required
              />
            </div>
          </div>
        </div>
        
        <!-- Email -->
        <div>
          <label class="block text-sm font-light text-gray-700 mb-1">Correo electrónico <span class="text-xs text-gray-500">(requerido)</span></label>
          <input 
            type="email" 
            name="email"
            class="w-full px-0 py-2 border-0 border-b border-gray-300 focus:outline-none focus:border-gray-900 bg-transparent"
            required
          />
        </div>
        
        <!-- Teléfono -->
        <div>
          <label class="block text-sm font-light text-gray-700 mb-1">Teléfono</label>
          <input 
            type="tel" 
            name="telefono"
            class="w-full px-0 py-2 border-0 border-b border-gray-300 focus:outline-none focus:border-gray-900 bg-transparent"
          />
        </div>
        
        <!-- Instagram -->
        <div>
          <label class="block text-sm font-light text-gray-700 mb-1">Usuario de Instagram</label>
          <input 
            type="text" 
            name="instagram"
            class="w-full px-0 py-2 border-0 border-b border-gray-300 focus:outline-none focus:border-gray-900 bg-transparent"
          />
          <p class="text-xs text-gray-500 mt-1">¡Conectemos! Nos ayuda a conocerte de una manera más personal.</p>
        </div>
        
        <!-- Mensaje -->
        <div>
          <label class="block text-sm font-light text-gray-700 mb-1">Tu Mensaje</label>
          <textarea 
            rows="4" 
            name="mensaje"
            class="w-full px-0 py-2 border-0 border-b border-gray-300 focus:outline-none focus:border-gray-900 bg-transparent"
          ></textarea>
        </div>
        
        <!-- Mensajes de estado del formulario -->
        <div id="result" class="hidden">
          <div id="success-message" class="bg-green-50 text-green-800 p-4 rounded-md hidden">
            <p class="font-medium">¡Mensaje enviado con éxito!</p>
            <p>Gracias por contactarnos. Te responderemos lo antes posible.</p>
          </div>
          <div id="error-message" class="bg-red-50 text-red-800 p-4 rounded-md hidden">
            <p class="font-medium">Ha ocurrido un error</p>
            <p>No se pudo enviar tu mensaje. Por favor, inténtalo de nuevo o contáctanos directamente por teléfono.</p>
          </div>
        </div>
        
        <!-- Botón de envío -->
        <div class="pt-6">
          <button 
            type="submit" 
            id="submit-button"
            class="px-8 py-3 bg-gray-900 text-white uppercase text-xs tracking-widest hover:bg-gray-800 transition-colors"
          >
            Enviar Mensaje
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
    const result = document.getElementById('result') as HTMLDivElement;
    const successMessage = document.getElementById('success-message') as HTMLDivElement;
    const errorMessage = document.getElementById('error-message') as HTMLDivElement;
    
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault(); // Prevenir el envío tradicional del formulario
        
        // Cambiar el texto del botón durante el envío
        if (submitButton) {
          submitButton.textContent = 'Enviando...';
          submitButton.disabled = true;
        }
        
        try {
          // Crear un objeto FormData con los datos del formulario
          const formData = new FormData(form);
          
          // Enviar los datos usando fetch
          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            body: formData
          });
          
          const data = await response.json();
          
          // Mostrar el resultado
          if (result) result.classList.remove('hidden');
          
          if (data.success) {
            // Mostrar mensaje de éxito
            if (successMessage) successMessage.classList.remove('hidden');
            if (errorMessage) errorMessage.classList.add('hidden');
            
            // Limpiar el formulario
            form.reset();
            
            // Desplazarse hasta el mensaje de éxito
            result.scrollIntoView({ behavior: 'smooth', block: 'center' });
          } else {
            // Mostrar mensaje de error
            if (errorMessage) errorMessage.classList.remove('hidden');
            if (successMessage) successMessage.classList.add('hidden');
            
            console.error('Error al enviar el formulario:', data);
          }
        } catch (error) {
          // Mostrar mensaje de error en caso de excepción
          if (result) result.classList.remove('hidden');
          if (errorMessage) errorMessage.classList.remove('hidden');
          if (successMessage) successMessage.classList.add('hidden');
          
          console.error('Error al enviar el formulario:', error);
        } finally {
          // Restaurar el botón
          if (submitButton) {
            submitButton.textContent = 'Enviar Mensaje';
            submitButton.disabled = false;
          }
        }
      });
    }
  });
</script>
